<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="author" content="BotoX">
<meta name="description" content="VLT Custom Firmware Toolkit">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon.png') }}">
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='newstyle.css') }}">
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='bootstrap.min.css') }}">

<title>VLT Custom Firmware Toolkit</title>
</head>

<body onload="OnLoad()">

<noscript>Diese Webseite benötigt JavaScript.</noscript>

    <div id="disclaimer" class="modal red darken-4 white-text">
        <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">HAFTUNGSAUSSCHLUSS</h4>
            </div>
            <div class="modal-body">
                Ich nehme zur Kenntnis, dass vlt-firmwares.com lediglich Informationen und Dienste für Testzwecke zur Verfügung stellt.
                <br />
                Für eventuelle Schäden an Sache oder Person, die sich durch das Einspielen einer veränderten Firmware ergeben, übernehme ich (der Endanwender) die volle Verantwortung.
                <br />
		<br /><b>Ich bin selbst im Besitz des Gerätes und der Software!</b>

		<br /><br /><u>Disclaimer</u><br />vlt-firmwares.com steht in keiner Verbindung zu irgendeinem Gerätehersteller. vlt-firmwares.com hostet keine Firmware Dateien und generiert auch keine fertigen Firmware Dateien. Der Endanwender hat die Option, eine Datei, die ihm gehört, hochzuladen und durch einen Dienst verändern zu lassen. Die Datei wird durch den Dienst an den angegebenen Stellen verändert, selbst aber in keinster Weise zwischengespeichert.
            </div>
            <div class="modal-footer red darken-2 white-text">
		    <i>Mit einem Klick auf "Einverstanden" und/oder der Nutzung dieses Dienstes akzeptiere ich (der Endanwender) die oben genannten Hinweise und Haftungsausschluss.</i>
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Einverstanden</button>
            </div>
        </div>
        </div>
    </div>

<div class="container">
    <div class="row"><div class="col center-block text-center">
        <h1>VLT Firmwares</h1>
    </div></div>

    <div class="row"><div class="col">
	    <p class="text">
		Konfiguriere deine eigene VLT Firmware durch Anpassung der unten stehenden Optionen. Standardmäßig wird nichts gepatcht, sondern erst wenn eine Checkbox aktiviert wird.<br/>
	    </p>
    </div></div>

    <div class="row">
        <div class="col">
            Voreinstellung:
        </div>
        <div class="col">
            <select class="form-select" id="modeselect" onchange="ChangeMode()">
                <option value="default">Basis</option>
                <option value="custom">Erweitert</option>
                <option value="custom-dev">Experimentell</option>
            </select>
        </div>
    </div>

    <hr>
    <form action="/cfw"  method = "POST" enctype = "multipart/form-data">
    <div class="card-group">
        <div class="card text-center m-1">
            <div class="card-header">
                <input class="form-check-input" name="brakelight_mod" type="checkbox">
                <label class="form-check-label"><b>Bremslicht Mod</b></label>
            </div>
            <div class="card-body">
                <div class="card-text">
                    Bei Aktivem GM verhält sich das Rücklicht wie als wenn GM nicht Aktiv ist.
                    Es Blinkt nicht wenn man die Bremse betätigt oder vom Gas geht.
                </div>
            </div>
        </div>
        <div class="card text-center m-1">
            <div class="card-header">
                <input class="form-check-input" name="shutdown_time_cb" type="checkbox" onchange="CheckForm('shutdown_time', this);">
                <label class="form-check-label"><b>Ausschaltzeit</b></label>
            </div>
            <div class="card-body">
                <div class="card-title">
			<div>Sekunden</div>
			<span class="input-group-text"><button type="button" class="btn btn-secondary" onclick="SliderDown('shutdown_time', 'shutdown_value')">-</button><input class="form-range" name="shutdown_time" type="range" step="0.5" min="1" max="9" value="3" onchange="OnSliderChange('shutdown_value', this.value)" oninput="OnSliderChange('shutdown_value', this.value)" disabled><button type="button" class="btn btn-primary" onclick="SliderUp('shutdown_time', 'shutdown_value')">+</button></span><div id="shutdown_value">3</div>
                </div>
                <div class="card-text">
                    Hierbei handelt es sich um die Dauer für die man den An/Aus-Knopf gedrückt halten muss, bis der Roller ausgeht.
                </div>
            </div>
        </div>
    </div>
    <div class="card-group">
        <div class="card text-center m-1">
            <div class="card-header">
                <input class="form-check-input" name="speed_plus2" type="checkbox">
                <label class="form-check-label"><b>22&nbsp;km/h Mod</b></label>
            </div>

            <div class="card-body">
                Hebt das Deutsche Geschwindigkeits Limit des Sport Modus auf 22Kmh an.
                Nutzt die aktuelle Gesetzeslage komplett aus, da man aktuell in DE 20 + 2Kmh Toleranz schnell fahren darf. Nicht wundern, Der Tacho vom Pro 2 zeigt nach 2-3 sekunden Top Speed nur 21Kmh an. Es schwankt aber zwischen 21,4 - 21,8 Kmh nur wird es mangels Display Funktion nicht angezeigt.
            </div>
        </div>
    </div>
    <div class="card-group">
        <div class="card text-center m-1">
            <div class="card-header">
                <input class="form-check-input" type="checkbox" name="ltgm">
                <label class="form-check-label"><b>LTGM</b></label>
            </div>

            <div class="card-body">
                Lite Touch GM gibt direkte Kontrolle über die Regionskennung in der Firmware.
				LTGM kann per App ein und ausgeschaltet werden.
				Empfohlene App zum ein und ausschalten ist die <a href="https://rollerplausch.com/threads/neue-gm-app-fuer-xiaomi-1s-pro2-unterstuetzt-alle-ble-versionen.4220/">HomeMi App von @nandtek</a>
				Bei Neustart bzw. Ausschalten des Rollers wird LTGM ebenfalls zurückgesetzt.
            </div>
        </div>

        <div class="card text-center m-1">
            <div class="card-header">
                <input class="form-check-input" type="checkbox" name="remove_autobrake">
                <label class="form-check-label"><b>Automatisches abbremsen deaktivieren</b></label>
            </div>
            <div class="card-body">
                <div class="card-text">
                    Der Roller bremst nicht mehr automatisch ab und piepst auch nicht.
                    Z.b. wenn man einen Hang runter rollt (wenn man vom Gas geht greift natürlich trotzdem Kers) oder im leerlauf schnell auf Vmax beschleunigt. Es wird auch nicht von alleine über 20Kmh oder mit 22Kmh Mod über 22Kmh schnell wenn das Rad in der Luft dreht.
                </div>
            </div>
        </div>
    </div>
    <div class="card-group">
        <div class="card text-center m-1">
            <div class="card-header">
                <input class="form-check-input" name="motor_start_speed_cb" type="checkbox" onchange="CheckForm('motor_start_speed', this);">
                <label class="form-check-label"><b>Motor Startgeschwindigkeit</b></label>
            </div>
            <div class="card-body">
                <div class="card-title">
			<div>km/h</div>
			<span class="input-group-text"><button type="button" class="btn btn-secondary" onclick="SliderDown('motor_start_speed', 'mss_value')">-</button><input class="form-range" name="motor_start_speed" type="range" step="0.5" min="0" max="10" value="5" onchange="OnSliderChange('mss_value', this.value)" oninput="OnSliderChange('mss_value', this.value)" disabled><button type="button" class="btn btn-primary" onclick="SliderUp('motor_start_speed', 'mss_value')">+</button></span><div id="mss_value">5</div>
                </div>
                <div class="card-text">
                    Die Startgeschwindigkeit bei dem der Motor aktiviert wird.
                    Standard ist 5-Kmh. 0-Kmh braucht trotzdem einen winzigen Stubser damit der Motor los geht.
                </div>
            </div>
        </div>
    </div>
    <div class="card-group">
        <div class="card text-center m-1 custom" hidden>
            <div class="card-header">
                <input class="form-check-input" type="checkbox" name="remove_charging_mode">
                <label class="form-check-label"><b>Zusatzakku Fix</b></label>
            </div>
            <div class="card-body">
                <div class="card-title"><i>Remove charging mode</i></div>
                <div class="card-text">
                    Zusatzakku Auflade Fix.
                    Roller fährt, trotz alledem der interne Akku vom Externen geladen wird.
                </div>
            </div>
        </div>
        <div class="card text-center m-1 custom" hidden>
            <div class="card-header">
                <input class="form-check-input" name="remove_kers" type="checkbox">
                <label class="form-check-label"><b>KERS ausschalten</b></label>
            </div>
            <div class="card-body">
                Rekuperation (KERS) wird beim Ausrollen komplett entfernt.
                Energierückgewinnung greift nur noch wenn die elektrische Bremse (Rechts) betätigt wird.
            </div>
        </div>
    </div>

    <div class="card-group">
        <div class="card text-center m-1 custom" hidden>
            <div class="card-header">
                <input class="form-check-input" type="checkbox" name="cc_unlock">
                <label class="form-check-label"><b>Tempomat Unlock</b></label>
            </div>
            <div class="card-body">
                <div class="card-text">
                    Schaltet den Tempomat für DE Seriennummern frei.
                </div>
            </div>
        </div>
        <div class="card text-center m-1 custom" hidden>
            <div class="card-header">
                <input class="form-check-input" name="cc_delay_cb" type="checkbox" onchange="CheckForm('cc_delay', this);">
                <label class="form-check-label"><b>Tempomat Verzögerung</b></label>
            </div>
            <div class="card-body">
                <div class="card-title">
			<div>Sekunden</div>
			<span class="input-group-text"><button type="button" class="btn btn-secondary" onclick="SliderDown('cc_delay', 'cc_delay_val')">-</button><input class="form-range" name="cc_delay" type="range" step="0.5" min="1" max="9" value="5" onchange="OnSliderChange('cc_delay_val', this.value)" oninput="OnSliderChange('cc_delay_val', this.value)" disabled><button type="button" class="btn btn-primary" onclick="SliderUp('cc_delay', 'cc_delay_val')">+</button></span><div id="cc_delay_val">5</div>
                </div>
                <div class="card-text">
                    Hierbei handelt es sich um die Dauer für die man den Gashebel in einer Position halten muss, bis der Tempomat aktiviert wird.
                </div>
            </div>
        </div>
    </div>

    <div class="card-group">
        <div class="card text-center m-1 custom" hidden>
            <div class="card-header">
                <input class="form-check-input" name="wheelsize_cb" type="checkbox" onchange="CheckForm('wheelsize', this);">
                <label class="form-check-label"><b>Rad Durchmesser</b></label>
            </div>

            <div class="card-body">
                <div class="card-title center-block">
			<div>Zoll</div>
			<span class="input-group-text"><button type="button" class="btn btn-secondary" onclick="SliderDown('wheelsize', 'wheelsize_value')">-</button><input class="form-range" name="wheelsize" type="range" step="0.1" min="0" max="30" value="8.5" onchange="OnSliderChange('wheelsize_value', this.value)" oninput="OnSliderChange('wheelsize_value', this.value)" disabled><button type="button" class="btn btn-primary" onclick="SliderUp('wheelsize', 'wheelsize_value')">+</button></span><div id="wheelsize_value">8.5</div>

                </div>
                <div class="card-text">
                    Passt GPS Geschwindigkeit und Motor-Koeffizient (Anzugsverhalten) für unterschiedliche Radgrößen an.
                </div>
            </div>
        </div>
    </div>
    <div class="card-group">
        <div class="card text-center m-1 border-warning custom-dev" hidden>
            <div class="card-header">
                <input class="form-check-input" type="checkbox" name="relight_mod">
                <label class="form-check-label"><b>ReLight Mod</b></label>
            </div>
            <div class="card-body">
                <div class="card-title">
			Ersetzt das blinkende Rücklicht durch Tastenkombinationen, aktuell Bremse+Gas.<br />
			Konfiguriere hier deinen Effekt:
		</div>
                <div class="card-text">
			<input class="form-check-input" type="checkbox" name="relight_dpc">
			<label class="form-check-label"><b>DPC</b></label><br/>
			<input class="form-check-input" type="checkbox" name="relight_gm">
			<label class="form-check-label"><b>LTGM</b></label><br/>
			<input class="form-check-input" type="checkbox" name="relight_reset">
			<label class="form-check-label"><b>Reset (Zurücksetzen statt Setzen)</b></label><br/>
			<input class="form-check-input" type="checkbox" name="relight_beep">
			<label class="form-check-label"><b>Piep</b></label><br/>
			<input class="form-check-input" type="checkbox" name="relight_delay">
			<label class="form-check-label"><b>1s Verzögerung</b></label><br/>
		</div>
            </div>
        </div>
    </div>
    <div class="card-group">
        <div class="card text-center m-1 border-warning custom" hidden>
            <div class="card-header">
                <input class="form-check-input" type="checkbox" name="crc_1000">
                <label class="form-check-label"><b>CRC 1000</b></label>
            </div>
            <div class="card-body">
                Setzt den Current Raising Coefficient auf 1000. Damit steigt die Beschleunigung, ohne die Stromgrenzwerte des Rollers zu verschieben.
				<span style="color: red;">&#9888;&nbsp;Verringert die Max Reichweite.</span>
            </div>
        </div>
    </div>
    <div class="card-group">
        <div class="card text-center m-1 border-warning custom" hidden>
            <div class="card-header">
                <input class="form-check-input" type="checkbox" name="thirtyamps">
                <label class="form-check-label"><b>30 Ampere Speed Mode</b></label>
            </div>
            <div class="card-body">
                Der Nennstrom / DC Phasenstrom für den Speed Mode wird auf 30A (Ampere) gesetzt. Standard sind 20A beim 1S und 25A beim Pro2.<br> 
				Ermöglicht ein stabileres halten der Wunschgeschwindigkeit bei Steigungen. Beschleunigung wird dadurch nicht pauschal "besser"<br>
				<span style="color: red;">&#9888;&nbsp;Verringert die Max Reichweite und ab circa 10% Akku wird die Endgeschwindigkeit stark gedrosselt.</span>
            </div>
        </div>
    </div>

    <hr>
    <div class="row">
        <div class="col-sm-4">
            Achtung: Bitte prüfe vor dem Patchen erneut, ob alle gemachten Eingaben passen!!<br />
        </div>
        <div class="col">
            <b><label id="drvselect" class="custom-file-label" for="file">Eingabe-Datei auswählen:</label></b>

              <input type="file" id="file" class="custom-file-input" name="filename">
          <input type="submit" name="patchorzip" value="Patch!">
        </div>
    </div>

    </form>

    <div class="row">
        <div class="col">
            <b><span style="color: red;">&#9888;&nbsp;NEW </span>Dieses Tool wendet auf die hochgeladene Datei die ausgewählten Patches an (im Forum dokumentiert) und liefert diese ohne Zwischenspeicherung wieder zurück als Download.</b><br>
            <b><span style="color: red;">&#9888;&nbsp;NEW </span>Die gepatchte Datei sollte anschließend kontrolliert und nach Einsatzzweck aufbereitet werden. Bitte dazu selbst im Forum informieren!</b>.
        </div>
    </div>

    <hr>
    <div class="row">
	    <div class="col">
		<h4 class="text-start">Credits</h3>
		<p class="text">
			VLT Firmwares von VooDooShamane (Rollerplausch): <a href="https://rollerplausch.com/threads/vlt-firmwares-in-de-22kmh-mit-neuster-vanilla-firmware-und-vieles-mehr.3197/">Link zum Thread</a><br/>
			Großen Dank an die Tester: @Daniel_Gee @mhdot
		</p>
	    </div>
	    <div class="col">
		<h4 class="text-start">Disclaimer</h3>
		<p class="text-md">
		    VLT Firmware Patcher by NandTek (dnandha): <a href="https://github.com/dnandha/vlt-firmware-patcher" target="_blank">Link zu GitHub</a> <br/>
		    Basiert auf BotoX' m365 Firmware Patcher: <a href="https://github.com/BotoX/xiaomi-m365-firmware-patcher" target="_blank">Link zu GitHub</a>
		</p>
	    </div>

    </div>
</div>

<script>
    var forms = {
        "VERSION": "version",
        "LTGM": "ltgm",
        "BRAKELIGHT_MOD": "brakelight_mod",
        "SPEED_PLUS2": "speed_plus2",
        "MOTOR_START_SPEED": "motor_start_speed",
        "REMOVE_KERS": "remove_kers",
        "REMOVE_AUTOBRAKE": "remove_autobrake",
        "REMOVE_CHARGING_MODE": "remove_charging_mode",
        "CC_UNLOCK": "cc_unlock",
        "CC_DELAY": "cc_delay",
        "WHEELSIZE": "wheelsize",
        "THIRTYAMPS": "thirtyamps",
        "CRC_1000": "crc_1000",
        "SHUTDOWN_TIME": "shutdown_time",

        "RELIGHT_MOD": "relight_mod",
        "RELIGHT_RESET": "relight_reset",
        "RELIGHT_GM": "relight_gm",
        "RELIGHT_DPC": "relight_dpc",
        "RELIGHT_BEEP": "relight_beep",
        "RELIGHT_DELAY": "relight_delay",
    };

    var formValues = Object.values(forms);
    var queryStrings = window.location.search.substring(1);
    var queries = queryStrings.split('&');

    for (var i = 0; i < queries.length; i++) {
        var query = queries[i];
        var tmp = query.split('=');
        var found = false;

        for (var j = 0; j < formValues.length; j++) {
            if (formValues[j] === tmp[0]) {
                found = true;
                break;
            }
        }

        if(found) {
            if (tmp[1] === 'on') {
                tmp[1] = true;
            }

            ChangeForm(tmp[0], tmp[1], true);
        }
    }

    function OnSliderChange(elname, value) {
        var ws_val = document.getElementById(elname);
	ws_val.innerHTML = value;
    }

    function Round(value) {
	    return Math.round(value * 10) / 10;
    }

    function SliderUp(name, valuename) {
	    var slider = document.getElementsByName(name)[0];
	    if (slider.disabled) {
		    return;
	    }
	    const value = Round(parseFloat(slider.value) + parseFloat(slider.step));

	    slider.value = value

	    OnSliderChange(valuename, value);
    }

    function SliderDown(name, valuename) {
	    var slider = document.getElementsByName(name)[0];
	    if (slider.disabled) {
		    return;
	    }
	    const value = Round(parseFloat(slider.value) - parseFloat(slider.step));

	    slider.value = value

	    OnSliderChange(valuename, value);
    }

    function GetForm(name) {
        return document.getElementsByName(name)[0];
    }

    function GetFormValue(name) {
        var o = GetForm(name);

        if (o.type === "checkbox") {
            return o.checked;
        }

        return o.value;
    }

    function GetPatchCheckBox(name) {
    	return GetForm(`${name}_cb`);
    }

    function CheckForm(name, cb) {
        GetForm(name).disabled = !cb.checked;
    }

    function ChangeForm(name, value, patch) {
        var o = GetForm(name);

        if (o.type === "checkbox") {
            o.checked = value;
        } else {
            o.value = value;
        }
        if(o.onchange) { o.onchange(); }

        if (typeof patch === 'boolean') {
            var cb = GetPatchCheckBox(name);

            if (cb) {
                cb.checked = patch;
                if(cb.onchange) { cb.onchange(); }
            }
        }
    }

    function OnLoad(){
        var warning = new bootstrap.Modal(document.getElementById('disclaimer'));
	    warning.show();

	    ChangeMode();
    }

    function ChangeMode(){
        Preset_Default();

        var mode = document.getElementById("modeselect").value
        var divs = document.getElementsByClassName("custom");
        for (var i=0; i < divs.length; i++) {
            if (mode === "custom" || mode === "custom-dev") {
                divs[i].removeAttribute("hidden");
            } else {
                const hidden = document.createAttribute("hidden");
                divs[i].setAttributeNode(hidden);
            }
        }

        divs = document.getElementsByClassName("custom-dev");
        for (var i=0; i < divs.length; i++) {
            if (mode === "custom-dev") {
                divs[i].removeAttribute("hidden");
            } else {
                const hidden = document.createAttribute("hidden");
                divs[i].setAttributeNode(hidden);
            }
        }
    }

    function Preset_Default() {
        ChangeForm(forms.LTGM, false);
        ChangeForm(forms.BRAKELIGHT_MOD, false);
        ChangeForm(forms.SPEED_PLUS2, false);
        ChangeForm(forms.MOTOR_START_SPEED, "5", false);
        ChangeForm(forms.REMOVE_AUTOBRAKE, false);
        ChangeForm(forms.REMOVE_KERS, false);
        ChangeForm(forms.REMOVE_CHARGING_MODE, false);
        ChangeForm(forms.CC_UNLOCK, false);
        ChangeForm(forms.CC_DELAY, "5.0", false);
        ChangeForm(forms.WHEELSIZE, "8.5", false);
        ChangeForm(forms.THIRTYAMPS, false);
        ChangeForm(forms.CRC_1000, false);
        ChangeForm(forms.SHUTDOWN_TIME, "3.0", false);

        ChangeForm(forms.RELIGHT_MOD, false);
        ChangeForm(forms.RELIGHT_RESET, false);
        ChangeForm(forms.RELIGHT_GM, false);
        ChangeForm(forms.RELIGHT_DPC, false);
        ChangeForm(forms.RELIGHT_BEEP, false);
        ChangeForm(forms.RELIGHT_DELAY, false);
    }
</script>

<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>

</body>
